from keras.models import load_model  # TensorFlow is required for Keras to work
from PIL import Image, ImageOps  # Install pillow instead of PIL
import numpy as np

recycling_tips = {
    "–ë–∞—Ç–∞—Ä–µ–π–∫–∞": (
        "üîã **–ë–∞—Ç–∞—Ä–µ–π–∫–∞** ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –æ–ø–∞—Å–Ω—ã—Ö –≤–∏–¥–æ–≤ –æ—Ç—Ö–æ–¥–æ–≤. "
        "–û–¥–Ω–∞ –≤—ã–±—Ä–æ—à–µ–Ω–Ω–∞—è –±–∞—Ç–∞—Ä–µ–π–∫–∞ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—è–∑–Ω–∏—Ç—å —Å–æ—Ç–Ω–∏ –ª–∏—Ç—Ä–æ–≤ –≤–æ–¥—ã –∏ –ø–æ—á–≤—ã —Ç—è–∂—ë–ª—ã–º–∏ –º–µ—Ç–∞–ª–ª–∞–º–∏. "
        "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–π –µ—ë –≤ –æ–±—ã—á–Ω—ã–π –º—É—Å–æ—Ä! –°–¥–∞–≤–∞–π –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –ø—Ä–∏—ë–º–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö –∏–ª–∏ –¢–¶. "
        "–≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∑–¥–æ—Ä–æ–≤—å–µ –ø—Ä–∏—Ä–æ–¥—ã –∏ –ª—é–¥–µ–π."
    ),
    "–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä": (
        "üçé **–û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –º—É—Å–æ—Ä** ‚Äî —ç—Ç–æ –ø–∏—â–µ–≤—ã–µ –æ—Ç—Ö–æ–¥—ã, –∫–æ–∂—É—Ä–∞, –ª–∏—Å—Ç—å—è –∏ –ø—Ä–æ—á–µ–µ. "
        "–•–æ—Ç—è –æ–Ω —Ä–∞–∑–ª–∞–≥–∞–µ—Ç—Å—è, –Ω–∞ —Å–≤–∞–ª–∫–µ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –º–µ—Ç–∞–Ω–∞ ‚Äî –ø–∞—Ä–Ω–∏–∫–æ–≤–æ–≥–æ –≥–∞–∑–∞. "
        "–õ—É—á—à–µ –∫–æ–º–ø–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–∞ –∏–ª–∏ —Å–¥–∞–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä '–û—Ä–≥–∞–Ω–∏–∫–∞', –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ —Ç–≤–æ—ë–º –≥–æ—Ä–æ–¥–µ. "
        "–¢–∞–∫ —Ç—ã –ø–æ–º–æ–∂–µ—à—å —É–º–µ–Ω—å—à–∏—Ç—å –≤—ã–±—Ä–æ—Å—ã –∏ –ø–æ–ª—É—á–∏—à—å —É–¥–æ–±—Ä–µ–Ω–∏–µ!"
    ),
    "–ö–æ—Ä–∏—á–Ω–µ–≤–æ–µ —Å—Ç–µ–∫–ª–æ": (
        "üü§ **–ö–æ—Ä–∏—á–Ω–µ–≤–æ–µ —Å—Ç–µ–∫–ª–æ** —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –±—É—Ç—ã–ª–∫–∞—Ö –æ—Ç –Ω–∞–ø–∏—Ç–∫–æ–≤. "
        "–û–Ω–æ –æ—Ç–ª–∏—á–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞. "
        "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–º–æ–π –µ–≥–æ –∏ —Å–¥–∞–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç–µ–∫–ª–∞ ‚Äî —ç—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ —Å–Ω–∏–∂–∞–µ—Ç –æ–±—ä—ë–º –æ—Ç—Ö–æ–¥–æ–≤."
    ),
    "–ö–∞—Ä—Ç–æ–Ω": (
        "üì¶ **–ö–∞—Ä—Ç–æ–Ω** ‚Äî —ç—Ç–æ —É–ø–∞–∫–æ–≤–∫–∞, –∫–æ—Ä–æ–±–∫–∏, —è—â–∏–∫–∏. "
        "–û–Ω —Ö–æ—Ä–æ—à–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—è–∑–Ω—ë–Ω –∂–∏—Ä–æ–º –∏–ª–∏ –≤–ª–∞–≥–æ–π. "
        "–ü–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π —É–±–µ—Ä–∏ —Å–∫–æ—Ç—á, —Å–ª–æ–∂–∏ –∏ —Ö—Ä–∞–Ω–∏ –≤ —Å—É—Ö–æ–º –º–µ—Å—Ç–µ. "
        "–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–∞—Ä—Ç–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —É–ø–∞–∫–æ–≤–æ–∫, —ç–∫–æ–Ω–æ–º—è –¥–µ—Ä–µ–≤—å—è."
    ),
    "–û–¥–µ–∂–¥–∞": (
        "üëï **–û–¥–µ–∂–¥–∞** ‚Äî —Ç–µ–∫—Å—Ç–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø–æ—Å–ª—É–∂–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ. "
        "–•–æ—Ä–æ—à–∏–µ –≤–µ—â–∏ –º–æ–∂–Ω–æ –æ—Ç–¥–∞—Ç—å –≤ —Å–µ–∫–æ–Ω–¥-—Ö–µ–Ω–¥ –∏–ª–∏ –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. "
        "–ò–∑–Ω–æ—à–µ–Ω–Ω–æ–µ –±–µ–ª—å—ë –∏ —Ç–∫–∞–Ω—å –º–æ–∂–Ω–æ —Å–¥–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∏–ª—è. "
        "–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—É—Å–æ—Ä–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —É—Å—Ç–æ–π—á–∏–≤—É—é –º–æ–¥—É."
    ),
    "–ó–µ–ª–µ–Ω–æ–µ —Å—Ç–µ–∫–ª–æ": (
        "üçæ **–ó–µ–ª—ë–Ω–æ–µ —Å—Ç–µ–∫–ª–æ** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±—É—Ç—ã–ª–∫–∞—Ö –æ—Ç –Ω–∞–ø–∏—Ç–∫–æ–≤. "
        "–û–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –¥—Ä—É–≥–∏—Ö —Ü–≤–µ—Ç–æ–≤. "
        "–°–¥–∞–≤–∞—è –µ–≥–æ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, —Ç—ã –¥–∞—ë—à—å –≤—Ç–æ—Ä—É—é –∂–∏–∑–Ω—å –º–∞—Ç–µ—Ä–∏–∞–ª—É –∏ —É–º–µ–Ω—å—à–∞–µ—à—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—É—Å–æ—Ä–∞ –Ω–∞ —Å–≤–∞–ª–∫–∞—Ö."
    ),
    "–ú–µ—Ç–∞–ª–ª": (
        "ü•´ **–ú–µ—Ç–∞–ª–ª** ‚Äî —ç—Ç–æ –∂–µ—Å—Ç—è–Ω—ã–µ –∏ –∞–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –±–∞–Ω–∫–∏, —Ñ–æ–ª—å–≥–∞. "
        "–û–Ω –ª–µ–≥–∫–æ –ø–æ–¥–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–Ω–æ–≤–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã. "
        "–ü—Ä–æ–º–æ–π –±–∞–Ω–∫–∏ –∏ —Å–¥–∞–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–µ—Ç–∞–ª–ª–∞. "
        "–¢–∞–∫–æ–π —à–∞–≥ —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–±—ã—á–∏ —Ä—É–¥—ã –∏ –∑–∞—â–∏—â–∞–µ—Ç –æ–∫—Ä—É–∂–∞—é—â—É—é —Å—Ä–µ–¥—É."
    ),
    "–ë—É–º–∞–≥–∞": (
        "üìÑ **–ë—É–º–∞–≥–∞** ‚Äî –º–∞–∫—É–ª–∞—Ç—É—Ä–∞, —Ç–µ—Ç—Ä–∞–¥–∏, –≥–∞–∑–µ—Ç—ã. "
        "–û–Ω–∞ –ø–æ–¥–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ –¥–æ 5‚Äì7 —Ä–∞–∑, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–∞—á–∫–∞–Ω–∞. "
        "–°–æ—Ö—Ä–∞–Ω—è—è –±—É–º–∞–≥—É —á–∏—Å—Ç–æ–π –∏ —Å—É—Ö–æ–π, —Ç—ã –ø–æ–º–æ–≥–∞–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–µ—Ä–µ–≤—å—è –∏ —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤–æ–¥—ã –∏ —ç–Ω–µ—Ä–≥–∏–∏."
    ),
    "–ü–ª–∞—Å—Ç–∏–∫": (
        "‚ôªÔ∏è **–ü–ª–∞—Å—Ç–∏–∫** ‚Äî —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –∏ –æ–ø–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–∏—Ä–æ–¥—ã –º—É—Å–æ—Ä. "
        "–û–Ω —Ä–∞–∑–ª–∞–≥–∞–µ—Ç—Å—è —Å–æ—Ç–Ω–∏ –ª–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç –≤—Ä–µ–¥ –∂–∏–≤–æ—Ç–Ω—ã–º. "
        "–ü–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π –æ—á–∏—Å—Ç–∏ —É–ø–∞–∫–æ–≤–∫—É, —Å–Ω–∏–º–∏ –∫—Ä—ã—à–∫–∏, —Å–ø–ª—é—Å–Ω–∏ –∏ —Å–¥–∞–π –≤ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É. "
        "–ß–µ–º –±–æ–ª—å—à–µ –ø–ª–∞—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è ‚Äî —Ç–µ–º —á–∏—â–µ –ø–ª–∞–Ω–µ—Ç–∞!"
    ),
    "–û–±—É–≤—å": (
        "üëü **–û–±—É–≤—å** —Ç—Ä—É–¥–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑-–∑–∞ —Ä–∞–∑–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –Ω–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ. "
        "–ï—Å–ª–∏ –ø–∞—Ä–∞ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äî –ø–æ–¥–∞—Ä–∏ –∏–ª–∏ —Å–¥–∞–π –≤ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—É–Ω–∫—Ç. "
        "–°–∏–ª—å–Ω–æ –∏–∑–Ω–æ—à–µ–Ω–Ω—É—é –æ–±—É–≤—å –º–æ–∂–Ω–æ –æ—Ç–¥–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∏–ª—è, –µ—Å–ª–∏ —Ç–∞–∫–∏–µ –µ—Å—Ç—å."
    ),
    "–ë—ã—Ç–æ–≤–æ–π –º—É—Å–æ—Ä": (
        "üóëÔ∏è **–ë—ã—Ç–æ–≤–æ–π –º—É—Å–æ—Ä** ‚Äî —ç—Ç–æ –≤—Å—ë, —á—Ç–æ –Ω–µ –ø–æ–¥–¥–∞—ë—Ç—Å—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–µ: –≥—Ä—è–∑–Ω—ã–µ —Å–∞–ª—Ñ–µ—Ç–∫–∏, –æ–±—ë—Ä—Ç–∫–∏, –∑–∞–≥—Ä—è–∑–Ω—ë–Ω–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞. "
        "–û–Ω –∏–¥—ë—Ç –ø—Ä—è–º–∏–∫–æ–º –Ω–∞ —Å–≤–∞–ª–∫—É. "
        "–°—Ç–∞—Ä–∞–π—Å—è —É–º–µ–Ω—å—à–∞—Ç—å –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ø–æ–∫—É–ø–∞—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏ –≤—ã–±–∏—Ä–∞—è –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤–æ–µ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ."
    ),
    "–ë–µ–ª–æ–µ —Å—Ç–µ–∫–ª–æ": (
        "üç∂ **–ë–µ–ª–æ–µ —Å—Ç–µ–∫–ª–æ** ‚Äî —ç—Ç–æ –±–∞–Ω–∫–∏ –∏ –±—É—Ç—ã–ª–∫–∏ –∏–∑ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ —Å—Ç–µ–∫–ª–∞. "
        "–û–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∑–µ–ª—ë–Ω–æ–≥–æ –∏ –∫–æ—Ä–∏—á–Ω–µ–≤–æ–≥–æ. "
        "–ü–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π —Å–Ω–∏–º–∏ –∫—Ä—ã—à–∫—É, –ø—Ä–æ–º–æ–π –∏ –ø–æ–ª–æ–∂–∏ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. "
        "–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ –∏ —ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã."
    )
}

def predict_image_class(image_path, model_path='gtm_model/keras_model.h5', labels_path='gtm_model/labels.txt'):
    # Disable scientific notation for clarity
    np.set_printoptions(suppress=True)

    # Load the model
    model = load_model(model_path, compile=False)

    # Load the labels
    class_names = open(labels_path, "r", encoding='utf-8').readlines()

    # Create the array of the right shape to feed into the keras model
    # The 'length' or number of images you can put into the array is
    # determined by the first position in the shape tuple, in this case 1
    data = np.ndarray(shape=(1, 224, 224, 3), dtype=np.float32)

    # Replace this with the path to your image
    image = Image.open(image_path).convert("RGB")

    # resizing the image to be at least 224x224 and then cropping from the center
    size = (224, 224)
    image = ImageOps.fit(image, size, Image.Resampling.LANCZOS)

    # turn the image into a numpy array
    image_array = np.asarray(image)

    # Normalize the image
    normalized_image_array = (image_array.astype(np.float32) / 127.5) - 1

    # Load the image into the array
    data[0] = normalized_image_array

    # Predicts the model
    prediction = model.predict(data)
    index = np.argmax(prediction)
    class_name = class_names[index]
    confidence_score = prediction[0][index]
    
    if confidence_score < 0.3:
        return None, None

    # Print prediction and confidence score
    return class_name[2:len(class_name)-1], round(confidence_score*100, 1)